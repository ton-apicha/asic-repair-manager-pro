#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running pre-commit checks..."

# Type checking - Backend
echo "üì¶ Checking TypeScript types in backend..."
cd backend
npm run build > /tmp/backend-build.log 2>&1
backend_exit_code=$?
if [ $backend_exit_code -ne 0 ]; then
  echo "‚ö†Ô∏è  Backend type check found errors!"
  echo "Build output saved to /tmp/backend-build.log"
  echo "Please review and fix TypeScript errors."
  echo "You can still commit with --no-verify if needed."
  read -p "Continue with commit anyway? (y/n): " continue_commit
  if [ "$continue_commit" != "y" ]; then
    exit 1
  fi
fi
cd ..

# Type checking - Frontend
echo "üì¶ Checking TypeScript types in frontend..."
cd frontend
npm run build > /tmp/frontend-build.log 2>&1
frontend_exit_code=$?
if [ $frontend_exit_code -ne 0 ]; then
  echo "‚ö†Ô∏è  Frontend type check found errors!"
  echo "Build output saved to /tmp/frontend-build.log"
  echo "Please review and fix TypeScript errors."
  echo "You can still commit with --no-verify if needed."
  read -p "Continue with commit anyway? (y/n): " continue_commit
  if [ "$continue_commit" != "y" ]; then
    exit 1
  fi
fi
cd ..

echo "‚úÖ Pre-commit checks completed!"

